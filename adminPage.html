<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Booked Meetings</title>
    <link rel="stylesheet" href="src/adminPage.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<header>
    <h1>Booked Meetings</h1>
</header>
<div class="container" id="bookings-container">
    <div class="user-box" id="amine">
        <div class="user-name">User 1</div>
        <ul class="startup-list"></ul>
    </div>
    <div class="user-box" id="yvan">
        <div class="user-name">User 2</div>
        <ul class="startup-list"></ul>
    </div>
    <div class="user-box" id="faycal">
        <div class="user-name">User 3</div>
        <ul class="startup-list"></ul>
    </div>
    <div class="user-box" id="adama">
        <div class="user-name">User 4</div>
        <ul class="startup-list"></ul>
    </div>
    <div class="user-box" id="ismael">
        <div class="user-name">User 5</div>
        <ul class="startup-list"></ul>
    </div>
    <div class="user-box" id="alia">
        <div class="user-name">User 6</div>
        <ul class="startup-list"></ul>
    </div>
    <div class="user-box" id="asma">
        <div class="user-name">User 7</div>
        <ul class="startup-list"></ul>
    </div>
    <div class="user-box" id="brutus">
        <div class="user-name">User 8</div>
        <ul class="startup-list"></ul>
    </div>
    <div class="user-box" id="najib">
        <div class="user-name">User 9</div>
        <ul class="startup-list"></ul>
    </div>
    <div class="user-box" id="alyune">
        <div class="user-name">User 10</div>
        <ul class="startup-list"></ul>
    </div>
    <div class="user-box" id="babacar">
        <div class="user-name">User 11</div>
        <ul class="startup-list"></ul>
    </div>
</div>
<h2>Startups and their Bookings</h2>
<div class="faq-container" id="startups-container">
    <!-- FAQ section for startups -->
</div>
<footer>
    Â© 2024 Booking Platform. All Rights Reserved.
    <button onclick="clearBookings()">Clear All Bookings</button>
    <button onclick="exportToExcel()">Export to Excel</button>
</footer>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.17.0/dist/xlsx.full.min.js"></script>
<script>
    // Your Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyC-prGP8RsMBgnTqZoJCs5gU2VBBTuKSIE",
        authDomain: "booknow-f666b.firebaseapp.com",
        databaseURL: "https://booknow-f666b-default-rtdb.firebaseio.com",
        projectId: "booknow-f666b",
        storageBucket: "booknow-f666b.appspot.com",
        messagingSenderId: "157630359668",
        appId: "1:157630359668:web:67eeaf429392f2b5820921",
        measurementId: "G-CSPNH7ZHR1"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Initialize Realtime Database
    const db = firebase.database();

    // Helper function to generate a safe ID from a username
    function generateUserId(username) {
        return username.toLowerCase().replace(/[^a-z0-9]+/g, '');
    }

    document.addEventListener('DOMContentLoaded', () => {
        const bookingsContainer = document.getElementById('bookings-container');
        const startupsContainer = document.getElementById('startups-container');

        // Fetch bookings from Firebase
        db.ref('bookings').once('value', snapshot => {
            const bookings = snapshot.val() || {};

            // Populate user boxes
            for (const bookingId in bookings) {
                const { user, book } = bookings[bookingId];
                const userId = generateUserId(user);
                const userBox = document.getElementById(userId);
                if (userBox) {
                    const startupList = userBox.querySelector('.startup-list');
                    const listItem = document.createElement('li');
                    listItem.textContent = book;
                    startupList.appendChild(listItem);
                } else {
                    console.warn(`User box for user ID '${userId}' not found.`);
                }
            }

            // Create a list of all startups
            const allStartups = [
                "ToumAI", "Pwn & Patch", "KEREYA", "AquaDeep", "ME MOBILE ECOSYSTEMS", "Prilance", "Subito International",
                "Solar Dev", "Pixii Motors", "CLINICAGRO", "EdTrust", "Wayout", "Peelo", "REEBIRTH", "AMRA", "Yoteqi", "liberrex",
                "AGRIMINGA", "PIP PIP YALAH", "Schoolify", "SEHALINK (ex TA7ALIL.MA)", "KHABIRY", "W.ALLfit", "Wattnow", "Foodeals MEA",
                "DEALKHIR DaaS", "KWIKS FRC", "Jobold", "ILEY'COM", "Lmarchi.ma", "HOPEZ", "HISTORIAR", "Flouci (By Kaoun)", "eSteps Health"
            ];

            // Populate startups FAQ section
            allStartups.forEach(startup => {
                const faqItem = document.createElement('div');
                faqItem.classList.add('faq-item');
                faqItem.innerHTML = `<h3>${startup}</h3><div class="faq-item-content"></div>`;
                startupsContainer.appendChild(faqItem);

                faqItem.addEventListener('click', () => {
                    const content = faqItem.querySelector('.faq-item-content');
                    content.style.display = content.style.display === 'block' ? 'none' : 'block';
                });

                const content = faqItem.querySelector('.faq-item-content');
                for (const bookingId in bookings) {
                    const { user, book } = bookings[bookingId];
                    if (book === startup) {
                        const userItem = document.createElement('p');
                        userItem.textContent = user;
                        content.appendChild(userItem);
                    }
                }
            });
        });

        window.clearBookings = function() {
            db.ref('bookings').remove()
                .then(() => {
                    alert('All bookings have been cleared.');
                    location.reload();
                })
                .catch(error => {
                    console.error('Error clearing bookings:', error);
                });
        };

        window.exportToExcel = function() {
            db.ref('bookings').once('value', snapshot => {
                const bookings = snapshot.val() || {};

                // List of all users
                const allUsers = [
                    'amine', 'yvan', 'faycal', 'adama', 'ismael', 'alia', 'asma', 'brutus', 'najib', 'alyune', 'babacar'
                ];

                // Initialize user booking dictionary
                const users = {};
                allUsers.forEach(user => users[user] = []);

                // Organize bookings by user
                for (const bookingId in bookings) {
                    const { user, book } = bookings[bookingId];
                    const userId = generateUserId(user);
                    if (users[userId]) {
                        users[userId].push(book);
                    }
                }

                // Prepare data for Excel
                const maxStartups = Math.max(...Object.values(users).map(startups => startups.length));
                const data = [allUsers];

                for (let i = 0; i < maxStartups; i++) {
                    const row = allUsers.map(user => users[user][i] || '');
                    data.push(row);
                }

                // Create a new workbook and a worksheet
                const workbook = XLSX.utils.book_new();
                const worksheet = XLSX.utils.aoa_to_sheet(data);

                // Append worksheet to workbook
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Bookings');

                // Export to Excel
                XLSX.writeFile(workbook, 'bookings.xlsx');
            });
        };
    });
</script>
</body>
</html>
